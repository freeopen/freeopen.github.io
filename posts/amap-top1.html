<!DOCTYPE html>
<html lang="en">
<head>
          <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <!-- Enable responsiveness on mobile devices-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

        <title>Freeopen - 冠军方案之 高德算法大赛</title>
        <link rel="stylesheet" href="https://freeopen.github.io/theme/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://freeopen.github.io/theme/css/main.css" />
        <link rel="stylesheet" href="https://freeopen.github.io/theme/assets/academicons/css/academicons.min.css" />
        <link rel="stylesheet" href="https://freeopen.github.io/theme/assets/font-awesome/css/font-awesome.min.css" />
        <link rel="stylesheet" href="https://freeopen.github.io/theme/assets/fonts-googleapis/css/googleapi-fonts.css" />

        






</head>

<body id="index" class="theme-myblue" data-spy="scroll" data-target="#post_toc">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12 col-lg">
        <nav class="navbar navbar-expand-lg navbar-light sidebar" role="navigation">
          <a class="sidebar-about" href="https://freeopen.github.io/">Freeopen</a>
          <button class="navbar-toggler " type="button" data-toggle="collapse" data-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
          </button>
          <nav class="collapse navbar-collapse sidebar-nav flex-column" id="navbarNav">

              <a class="nav-link" href="https://freeopen.github.io/pages/guan-yu-zhe-li.html">关于这里</a>
              <a class="nav-link" href="https://freeopen.github.io/pages/zou-guo-lu-guo.html">走过路过</a>

              <a class="nav-link" href="https://freeopen.github.io/category/bian-cheng-zhi-hui.html">编程智慧</a>
              <a class="nav-link" href="https://freeopen.github.io/category/ji-qi-xue-xi.html">机器学习</a>
              <a class="nav-link" href="https://freeopen.github.io/category/shu-xue-za-tan.html">数学杂谈</a>
              <a class="nav-link" href="https://freeopen.github.io/category/su-cha-shou-ce.html">速查手册</a>
            <div class="sidebar-icons">
              <hr>
                <a href="" title="Atom feed" target="_blank" 
                    style="display: inline; padding: 0px 0px 0px 0; margin: 3px 4px 0 0; white-space: nowrap; font-size:2.5em;">
                  <i class="fa fa-rss-square"></i>
                </a>
                <a href="https://github.com/freeopen" title="Software I released on Github" 
                      target="_blank" style="display: inline; padding: 0px 0px 0px 0; margin: 3px 4px 0 0; white-space: nowrap; font-size:2.5em;"><i class="fa fa-github-square"></i> </a>
                <a href="Mailto:freeopen@163.com" title="My email" 
                    target="_blank" style="display: inline; padding: 0px 0px 0px 0;
                    margin: 3px 4px 0 0; white-space: nowrap; font-size:2.5em;"><i
                  class="fa fa-envelope-square"></i> </a>

            </div>
          </nav>

        </nav>

      </div>

      <div class="col-12 col-lg-7" role="main">
        <div id="content" class="content">
          <div class="post">
<section id="content" class="body">
  <header>
    <h1 class="entry-title">冠军方案之 高德算法大赛</h2>
 
  </header>
  <div class="post-info">

    <span>2021-02-10</span>


    <span>| By             <a class="url fn" href="https://freeopen.github.io/author/freeopen.html">freeopen</a>
    </span>

    <span>
      | 分类于 <a href="https://freeopen.github.io/category/ji-qi-xue-xi.html">机器学习</a>
    </span>

  </div><!-- /.post-info -->
  <div class="post content">
    <blockquote>
<p>冠军：北邮在读博士 朱奕达及团队</p>
</blockquote>
<h2 id="bi-sai-ren-wu">比赛任务</h2>
<h3 id="chu-sai-shu-ju"><strong>初赛数据：</strong></h3>
<p><strong>输入</strong>：给定一组含有GPS时间的图像序列（包含3-5帧图像），其中一幅图像作为参考帧。</p>
<p><strong>输出</strong>：以参考帧为准，输出该图像序列对应的路况状态（畅通、缓行和拥堵）。</p>
<p>图像序列由行车记录仪拍摄，路况真值（ground truth）是对应道路当前时刻真实的路况状态。</p>
<p><strong>数据信息：</strong></p>
<ul>
<li>图像序列的参考帧图像名。</li>
<li>图像序列的路况状态。</li>
<li>0：畅通，1：缓行，2：拥堵，-1：测试集真值未给出。</li>
<li>每帧图像采集时刻的GPS时间。</li>
<li>单位为秒。如GPS时间 1552806926 比 1552806921 滞后5秒钟。</li>
<li>A榜测试数据集换成高速行车记录仪采集的数据，GPS时间间隔缩短为1-2秒。</li>
</ul>
<h3 id="fu-sai-shu-ju"><strong>复赛数据：</strong></h3>
<ul>
<li>新增<code>封闭</code>的道路路况</li>
<li>移除了GPS时间信息</li>
</ul>
<h2 id="shu-ju-fen-xi_1">数据分析</h2>
<ul>
<li>前车遮挡视野内道路情况，从而影响对道路的判断；</li>
<li>对向车道和路边停靠车辆对行驶车道路况判断的影响；</li>
<li>数据众包导致相机安装存在角度偏差，从而导致图像角度不一致；</li>
<li>大雾天气和夜晚导致的图像不清晰。</li>
</ul>
<p>复赛阶段数据集：</p>
<ul>
<li>存在重复采样的图像序列（多为封闭类型的路况）</li>
<li>数据不均衡，缓行只有100多个序列，而封闭路段有2000多个序列</li>
</ul>
<h2 id="te-zheng-gong-cheng">特征工程</h2>
<h3 id="fen-che-dao-mu-biao-jian-ce">分车道目标检测</h3>
<p>目标检测采用 Faster RCNN 模型，将道路车辆分成5个类别进行标注，分别是：<strong>当前车辆前方行驶车道车辆，同向行驶车道左侧车辆，同向行驶车道右侧车辆，对向车道行驶车辆，街边侧向停车车辆</strong>。通过这样的标注对当前道路环境的车辆进行细致区分，后续将通过目标检测结果提取不同车道的车辆信息特征。</p>
<h3 id="te-zheng-ti-qu">特征提取</h3>
<p>基于目标检测的结果，提取60维特征，包括：</p>
<ol>
<li>GPS时间特征</li>
<li>关键帧中不同车道的车辆数量、面积、距离等</li>
<li>不同帧间检测框的动态特征，如车辆相似度、数目和面积变化等</li>
<li>Focal loss 降低样本不平衡</li>
</ol>
<p>其中：</p>
<ul>
<li>距离通过检测框的中心点，计算两点间的直线距离</li>
<li>不同分车道设计了两个权重，一为box数量与时间间隔的关系，数量增加分数降低，数量减少分数增加；二为box大小与时间间隔的关系，大小增加分数降低，大小减少分数增加。</li>
</ul>
<p>基于车辆相关特征训练 LGB 模型，B榜分数为0.6108。</p>
<h3 id="shu-ju-kuo-chong-yu-zeng-qiang">数据扩充与增强</h3>
<p>复赛阶段，针对类别数量的差异性，对缓行和拥堵类别做了数据扩充。对同一个序列中的图片，对每一帧图像都做了相同的数据变化，保证序列图片所处的相对环境是一致的。具体方法有：</p>
<ul>
<li>模型输入按照采样顺序选择3张图片；</li>
<li>针对相机安装存在角度偏差的问题，使用了平移，尺度加旋转变换的数据增强方法；</li>
<li>考虑到视频在采集时包含了一天中的不同时间节点，光照强度和天气条件也对图片造成了较大的影响， 加入了对比度，亮度和颜色增强的方法尽可能贴合实际数据。</li>
<li>从赛方给的数据中我们发现图片的清晰度和质量在不同序列之间存在差异，为此引入了运动模糊，中值滤波，高斯滤波，高斯模糊等方法进行数据增强。</li>
<li>此外图像中还存在一些脱敏信息，比如马赛克或者黑色条，我们也引入了一些cutof操作，减少模型对图像特定部分的依赖。</li>
</ul>
<h2 id="mo-xing-zeng-qiang_1">模型增强</h2>
<p>考虑到<strong>道路情况不止和车辆信息有关，还和道路及场景相关</strong>，基于分车道目标检测模型只对图像中的车道信息进行提取，而忽略了图片中的其他场景细节。并且目标检测模型本身存在一些误差，将目标检测结果特征再训练一个 LGB 模型可能会对误差进行传递。</p>
<p>端到端模型方案：即训练一个考虑图片全局信息的序列检测模型。</p>
<p><img alt="端到端模型" src="https://freeopen.github.io/images/densnet-amap.png"/></p>
<p>图片输入窗口大小是3，采用基于DenseNet121先对每张图片提取全局特征后，将图片特征按照时间顺序输入到GRU模型中得到最后的分类结果，在初赛中B榜上我们并没有使用数据增强的方法，最后取得了第一名的成绩0.6614。</p>
<h3 id="shi-kong-te-zheng-ti-qu">时空特征提取</h3>
<p>在复赛中，赛题发生了变化，新增了<code>封闭</code>这个类别后，基于特征的方案中需要根据障碍物标注进一步提高目标检测模型的鲁棒性，而实际障碍物标注数据质量并不高，尝试建模后发现效果并不如意。</p>
<p>为了减少误差的传递并考虑图片中更多的信息，基于端到端序列检测模型，提取了不同frame的特征后，再使用特征融合模块挖掘图片序列之间的时序特征关系。</p>
<p>特征融合模块中仍然使用双向GRU模型挖掘时间序列特征。将backbone替换成resnest101和SE_ResNext，在空间特征挖掘中，使用了<strong>位置注意力模块</strong>和<strong>通道注意力模块</strong>的双注意力网络。通道注意力模块校准序列图片中的特征图通道之间的关系，位置注意力模块对特征图中不同position进行关系强度的计算，从而挖掘序列图片中的局部关系变化和全局关系变化。</p>
<p>数据增强和样本扩充后，进行5折交叉验证的训练，选择了 5 个模型进行基于概率的融合，最后在B榜上得到了第二名的成绩0.7237，比第一名低了万分之9个点。</p>
<h2 id="mo-xing-luo-di-ji-zhan-wang_1">模型落地及展望</h2>
<p>在实际场景下，不仅仅有图片序列信息，还有道路等级数据，GPS时间，POI点等信息，可以将这些路网和时间信息通过 embedding 等方式处理成相应的特征融合到我们的模型中，更丰富的感知源丰富了我们的时空信息特征空间。</p>
<p>除此之外，还可以不断优化障碍物和车辆目标检测模型识别精度，从而制定更多的约束规则进行前处理和后处理的规则约束。</p>
<p>在模型落地时，可以通过模型蒸馏、优化加速等方式将模型下放到边缘节点进行分布式计算。交通路况状态在局部区域是互相影响的，所以我们还可以根据路网信息对城市进行栅格化处理，将众包得到的数据分栅格进行管理，这样我们可以得到该路段信息的临近路况辅助修正模型结果。</p>
  </div><!-- /.entry-content -->

  <!-- DISQUS 评论系统 -->

  <!-- giteement评论系统 -->

  <!-- Gitalk 评论 start  -->
  <!-- Link Gitalk 的支持文件  -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

  <div id="gitalk-container"></div>
      <script type="text/javascript">
      var gitalk = new Gitalk({

      // gitalk的主要参数
          clientID: 'a9a5636ca9f9c44f749f',
          clientSecret: 'a1d32a98cb3190ab1978faf73830add15f6179fb',
          repo: 'blog-discuss',
          owner: 'freeopen',
          admin: ['freeopen'],
          id: 'posts/amap-top1',
          proxy: 'https://netnr-proxy.cloudno.de/https://github.com/login/oauth/access_token'
      
      });
      gitalk.render('gitalk-container');
  </script>
  <!-- Gitalk end -->

</section>
          </div>

          <footer id="contentinfo" class="footer">
            <div class="footer-inner">
              无节操小广告<a href="https://freeopen.github.io/pages/da-shang.html"> 欢迎打赏 </a>
            </div>
          </footer><!-- /#contentinfo -->
        </div>
      </div>

      <div class="hidden-print hidden-xs hidden-sm hidden-md col-lg" id="post_toc" role="complementary">
        <nav class="sidebar-toc">
<!-- <section id="main_toc"> -->
    <div id="toc"><ul><li><a class="toc-href" href="#bi-sai-ren-wu" title="比赛任务">比赛任务</a><ul><li><a class="toc-href" href="#chu-sai-shu-ju" title="初赛数据：">初赛数据：</a></li><li><a class="toc-href" href="#fu-sai-shu-ju" title="复赛数据：">复赛数据：</a></li></ul></li><li><a class="toc-href" href="#shu-ju-fen-xi_1" title="数据分析">数据分析</a></li><li><a class="toc-href" href="#te-zheng-gong-cheng" title="特征工程">特征工程</a><ul><li><a class="toc-href" href="#fen-che-dao-mu-biao-jian-ce" title="分车道目标检测">分车道目标检测</a></li><li><a class="toc-href" href="#te-zheng-ti-qu" title="特征提取">特征提取</a></li><li><a class="toc-href" href="#shu-ju-kuo-chong-yu-zeng-qiang" title="数据扩充与增强">数据扩充与增强</a></li></ul></li><li><a class="toc-href" href="#mo-xing-zeng-qiang_1" title="模型增强">模型增强</a><ul><li><a class="toc-href" href="#shi-kong-te-zheng-ti-qu" title="时空特征提取">时空特征提取</a></li></ul></li><li><a class="toc-href" href="#mo-xing-luo-di-ji-zhan-wang_1" title="模型落地及展望">模型落地及展望</a></li></ul></div>
<!-- </section> -->
<!-- </section> -->
        </nav>
      </div>
    </div>
  </div>


<!--  -->
<!--  -->

<script src="https://freeopen.github.io/theme/js/jquery-3.3.1.slim.min.js"></script>
<script src="https://freeopen.github.io/theme/js/popper.min.js"></script>
<script src="https://freeopen.github.io/theme/js/bootstrap.min.js"></script>
</body>
</html>