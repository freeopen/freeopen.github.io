<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <title>Freeopen - 奇门遁甲</title>
    <subtitle>Freeopen 的个人兴趣研究所.</subtitle>
    <link href="https://www.freeopen.tech/categories/qi-men-dun-jia/atom.xml" rel="self" type="application/atom+xml"/>
    <link href="https://www.freeopen.tech"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2021-04-04T00:00:00+00:00</updated>
    <id>https://www.freeopen.tech/categories/qi-men-dun-jia/atom.xml</id>
    <entry xml:lang="en">
        <title>一支红杏出墙来</title>
        <published>2021-04-04T00:00:00+00:00</published>
        <updated>2021-04-04T00:00:00+00:00</updated>
        <author>
          <name>Unknown</name>
        </author>
        <link rel="alternate" href="https://www.freeopen.tech/centos-vpn/" type="text/html"/>
        <id>https://www.freeopen.tech/centos-vpn/</id>
        
        <content type="html">&lt;ul&gt;
&lt;li&gt;1CPU,512M&lt;&#x2F;li&gt;
&lt;li&gt;CentOS 8.2 aliyun&lt;&#x2F;li&gt;
&lt;li&gt;StrongSwan 5.8.2 &lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;yi-zhun-bei-jie-duan&quot;&gt;一、准备阶段&lt;&#x2F;h2&gt;
&lt;p&gt;新建服务器时，不选择 &lt;code&gt;安全加固&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;首先卸载阿里云安骑士&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;wget&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; http:&#x2F;&#x2F;update.aegis.aliyun.com&#x2F;download&#x2F;uninstall.sh&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-source z-shell&quot;&gt;source&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; .&#x2F;uninstall.sh&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;wget&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; http:&#x2F;&#x2F;update.aegis.aliyun.com&#x2F;download&#x2F;quartz_uninstall.sh&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-source z-shell&quot;&gt;source&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; .&#x2F;quartz_uninstall.sh&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;删除安骑士残留文件&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;pkill&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; aliyun-service&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;rm&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;fr&lt;&#x2F;span&gt; &#x2F;etc&#x2F;init.d&#x2F;agentwatch &#x2F;usr&#x2F;sbin&#x2F;aliyun-service&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;rm&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;rf&lt;&#x2F;span&gt; &#x2F;usr&#x2F;local&#x2F;aegis&lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;以 root 用户登录, 安装 epel 源，阿里云centos 8 的镜像比较新，不需要 update, 费流量。&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;dnf install epel-release&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;安装必备软件&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;dnf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; install nginx certbot iptables-services crontab strongswan&lt;&#x2F;span&gt;
&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;nginx开机启动&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;systemctl&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; enable nginx&lt;&#x2F;span&gt;
&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;启动nginx&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;systemctl&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; restart nginx&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;er-shen-qing-ssl-zheng-shu&quot;&gt;二、申请 ssl 证书&lt;&#x2F;h2&gt;
&lt;p&gt;StrongSwan IPsec IKEv2 连接需要用到服务器证书，用于验证服务器身份。由于自签发证书不受操作系统信任，我们需要申请 &lt;a rel=&quot;noopener nofollow noreferrer&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;letsencrypt.org&#x2F;&quot;&gt;Let’s Encrypt&lt;&#x2F;a&gt; 免费证书。
申请证书需要有域名，提前将域名解析到你的vps地址。&lt;&#x2F;p&gt;
&lt;p&gt;方式一，必须打开nginx, 能访问80端口&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;在web根目录创建临时目录&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;mkdir&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;p&lt;&#x2F;span&gt; &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;.well-known&#x2F;acme-challenge&lt;&#x2F;span&gt;
 
&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;--webroot 参数:指定使用临时目录的方式. -w 参数:指定后面-d 域名所在的根目录, 如果一次申请多个域的, 可以附加更多 -w...-d... 这段.&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;certbot&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; certonly&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;webroot&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;email&lt;&#x2F;span&gt; xxx@xxx.com&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;w&lt;&#x2F;span&gt; &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;d&lt;&#x2F;span&gt; xx.xxx.com&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;方式二，不需要打开nginx，能访问80端口&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;certbot&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; certonly&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;rsa-key-size&lt;&#x2F;span&gt; 2048&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;standalone&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;agree-tos&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;no-eff-email&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;email&lt;&#x2F;span&gt; xxx@gmail.com&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;d&lt;&#x2F;span&gt; xxx.xxx.com&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;certbot-zheng-shu-zi-dong-geng-xin&quot;&gt;Certbot 证书自动更新&lt;&#x2F;h3&gt;
&lt;p&gt;由于 &lt;a rel=&quot;noopener nofollow noreferrer&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;letsencrypt.org&#x2F;&quot;&gt;Let’s Encrypt&lt;&#x2F;a&gt; 证书只有90天有效期，为避免过期，需要启用自动续期。自动续期由定时任务完成。&lt;&#x2F;p&gt;
&lt;h4 id=&quot;fang-an-yi&quot;&gt;方案一&lt;&#x2F;h4&gt;
&lt;p&gt;编辑定时任务配置, 写入下面红色内容，这段的意思是每月28号凌晨3点运行 certbot renew 命令给证书续期，如果续期成功则重启 nginx 和 strongswan 服务。&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;vim  &#x2F;etc&#x2F;crontab&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;SHELL&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&#x2F;bin&#x2F;bash&lt;&#x2F;span&gt;
&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;PATH&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin&lt;&#x2F;span&gt;
&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;MAILTO&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;root&lt;&#x2F;span&gt;
 
&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; For details see man 4 crontabs&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt; 
&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; Example of job definition:&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; .---------------- minute (0 - 59)&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; |  .------------- hour (0 - 23)&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; |  |  .---------- day of month (1 - 31)&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; |  |  |  |  |&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; *  *  *  *  * user-name  command to be executed&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;0&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; 3 28 &lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt; root certbot renew&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;quiet&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;deploy-hook&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;systemctl restart nginx &amp;amp;&amp;amp; systemctl restart strongswan&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;加载定时任务配置，使之生效。&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;crontab &#x2F;etc&#x2F;crontab&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;h4 id=&quot;fang-an-er&quot;&gt;方案二&lt;&#x2F;h4&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ cat &#x2F;etc&#x2F;cron.d&#x2F;certbot

# &#x2F;etc&#x2F;cron.d&#x2F;certbot: crontab entries for the certbot package
#
# Upstream recommends attempting renewal twice a day
#
# Eventually, this will be an opportunity to validate certificates
# haven&amp;#39;t been revoked, etc.  Renewal will only occur if expiration
# is within 30 days.
SHELL=&#x2F;bin&#x2F;sh
PATH=&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin

0 *&#x2F;12 * * * root test -x &#x2F;usr&#x2F;bin&#x2F;certbot  -a \! -d &#x2F;run&#x2F;systemd&#x2F;system &amp;amp;&amp;amp;  perl -e &amp;#39;sleep int(rand(43200))&amp;#39; &amp;amp;&amp;amp;  certbot -q renew
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;意思说每天测试一下，证书是否在未来30天过期，如果过期就更新，否则什么也不做。&lt;&#x2F;p&gt;
&lt;h4 id=&quot;fang-an-san&quot;&gt;方案三&lt;&#x2F;h4&gt;
&lt;p&gt;安装了certbot nginx 插件后，执行一次证书更新后，发现输出的提示语中有句，certbot证书已能自动更新，仔细查看配置，发现生成了一个证书更新服务，名字叫certbot-renew, 由两个文件组成，certbot-renew.service 和 certbot-renew.timer。基本逻辑是每12小时，检查一下证书更新。&lt;&#x2F;p&gt;
&lt;p&gt;服务并没自动启动，须手动启动这个服务，我目前采用的这个方案。同时在crontab中设置每月指定时间重启一次 strongswan 服务。&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;systemctl enable --now certbot-renew.timer&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;注：证书更新后，vpn连接时还是会报错，说证书无效，原因是 strongswan 缓存的是旧的过期证书，重新启动一下 strongswan 即可。编辑 &#x2F;etc&#x2F;letsencrypt&#x2F;renewal&#x2F;example.com.conf 文件，在最后一行增加，将会在证书更新后，重新启动 strongswan.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;renew_hook = systemctl restart strongswan
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;san-an-zhuang-strongswan&quot;&gt;三、安装 strongswan&lt;&#x2F;h2&gt;
&lt;p&gt;注意， 本配置适用于5.8.2以上，基于 swanctl 配置。&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;vim &#x2F;etc&#x2F;strongswan&#x2F;swanctl&#x2F;conf.d&#x2F;xx.xxx.com.conf&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;connections {
    ikev2-eap-mschapv2 {
        version = 2
        unique = never
        rekey_time = 0s
        fragmentation = yes
        dpd_delay = 60s
        send_cert = always
        pools = ipv4-addrs, ipv6-addrs
        proposals = aes256-sha256-prfsha256-modp2048, aes256gcm16-prfsha384-modp1024, default
        local_addrs = %any
        local {
            certs = cert.pem
            id = xx.xxx.com
        }
        remote {
            auth = eap-mschapv2
            eap_id = %any
        }
        children {
            ikev2-eap-mschapv2 {
                local_ts = 0.0.0.0&#x2F;0,::&#x2F;0
                rekey_time = 0s
                dpd_action = clear
                esp_proposals = aes256-sha256, aes128-sha1, default
            }
        }
    }
}
pools {
    ipv4-addrs {
        addrs = 10.10.0.0&#x2F;24
        dns = 8.8.8.8,8.8.4.4,114.114.114.114
    }
    ipv6-addrs {
        addrs = fec1::0&#x2F;24
        dns = 2001:4860:4860::8888,2606:4700:4700::1111
    }
}
secrets {
    private-xxx {
        file = privkey.pem
    }   
    eap-user1 {
        id = user1
        secret = &amp;quot;123456&amp;quot;
    }
    eap-user2 {
        id = user2
        secret = &amp;quot;654321&amp;quot;
    }
}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;高亮部分中的 xx.xxx.com 替换为上面申请证书时用的域名， private-xxx 中的 xxx 随意，不要有符号，eap-user1 和 id = user1 中的 user1 替换为你想登录vpn使用的账号，secret = “123456” 改为你的密码。
如需添加多个用户，复制 eap-user1 { … } 段粘贴到下面，按上面规则设置新的用户名和密码即可。&lt;&#x2F;p&gt;
&lt;p&gt;安装证书，创建证书软链接到 strongswan 的对应目录。&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ln&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;s&lt;&#x2F;span&gt; &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;xx.xxx.com&#x2F;cert.pem &#x2F;etc&#x2F;strongswan&#x2F;swanctl&#x2F;x509&#x2F;cert.pem&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ln&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;s&lt;&#x2F;span&gt; &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;xx.xxx.com&#x2F;privkey.pem &#x2F;etc&#x2F;strongswan&#x2F;swanctl&#x2F;private&#x2F;privkey.pem&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ln&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;s&lt;&#x2F;span&gt; &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;xx.xxx.com&#x2F;chain.pem &#x2F;etc&#x2F;strongswan&#x2F;swanctl&#x2F;x509ca&#x2F;ca.pem&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;证书安装完成
重启服务&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;systemctl restart strongswan&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;开启内核转发&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;vim &#x2F;etc&#x2F;sysctl.conf&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;用下面内容替换配置文件中同名的项，如果没有则新增。&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;开启内核ipv4转发&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;net.ipv4.ip_forward&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; = 1&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;net.ipv4.conf.all.accept_redirects&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; = 0&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;net.ipv4.conf.all.send_redirects&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; = 0&lt;&#x2F;span&gt;
 
&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;开启内核ipv6转发&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;net.ipv6.conf.all.forwarding&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; = 1&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;重新加载配置&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;sysctl -p&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;配置防火墙&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;vim &#x2F;etc&#x2F;sysconfig&#x2F;iptables&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;在合适的位置添加以下规则, 注意顺序, 新增 屏蔽 安骑士 ip 脚本。&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; sample configuration for iptables service&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; you can edit this manually or use system-config-firewall&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; please do not ask us to add additional ports&#x2F;services to this default configuration&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;*nat&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;:PREROUTING&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; ACCEPT &lt;span class=&quot;z-keyword z-control z-regexp z-set z-begin z-shell&quot;&gt;[&lt;&#x2F;span&gt;0:0&lt;span class=&quot;z-keyword z-control z-regexp z-set z-end z-shell&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;:INPUT&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; ACCEPT &lt;span class=&quot;z-keyword z-control z-regexp z-set z-begin z-shell&quot;&gt;[&lt;&#x2F;span&gt;0:0&lt;span class=&quot;z-keyword z-control z-regexp z-set z-end z-shell&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;:POSTROUTING&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; ACCEPT &lt;span class=&quot;z-keyword z-control z-regexp z-set z-begin z-shell&quot;&gt;[&lt;&#x2F;span&gt;0:0&lt;span class=&quot;z-keyword z-control z-regexp z-set z-end z-shell&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;:OUTPUT&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; ACCEPT &lt;span class=&quot;z-keyword z-control z-regexp z-set z-begin z-shell&quot;&gt;[&lt;&#x2F;span&gt;0:0&lt;span class=&quot;z-keyword z-control z-regexp z-set z-end z-shell&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; POSTROUTING&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;s&lt;&#x2F;span&gt; 10.10.0.0&#x2F;24&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;o&lt;&#x2F;span&gt; eth0&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;m&lt;&#x2F;span&gt; policy&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;dir&lt;&#x2F;span&gt; out&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;pol&lt;&#x2F;span&gt; ipsec&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; POSTROUTING&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;s&lt;&#x2F;span&gt; 10.10.0.0&#x2F;24&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;o&lt;&#x2F;span&gt; eth0&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; MASQUERADE&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;COMMIT&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;*filter&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;:INPUT&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; ACCEPT &lt;span class=&quot;z-keyword z-control z-regexp z-set z-begin z-shell&quot;&gt;[&lt;&#x2F;span&gt;0:0&lt;span class=&quot;z-keyword z-control z-regexp z-set z-end z-shell&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;:FORWARD&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; ACCEPT &lt;span class=&quot;z-keyword z-control z-regexp z-set z-begin z-shell&quot;&gt;[&lt;&#x2F;span&gt;0:0&lt;span class=&quot;z-keyword z-control z-regexp z-set z-end z-shell&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;:OUTPUT&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; ACCEPT &lt;span class=&quot;z-keyword z-control z-regexp z-set z-begin z-shell&quot;&gt;[&lt;&#x2F;span&gt;0:0&lt;span class=&quot;z-keyword z-control z-regexp z-set z-end z-shell&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;m&lt;&#x2F;span&gt; state&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;state&lt;&#x2F;span&gt; RELATED,ESTABLISHED&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;p&lt;&#x2F;span&gt; icmp&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;i&lt;&#x2F;span&gt; lo&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;s&lt;&#x2F;span&gt; 140.205.201.0&#x2F;24&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; DROP&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;s&lt;&#x2F;span&gt; 140.205.255.0&#x2F;24&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; DROP&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;p&lt;&#x2F;span&gt; tcp&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;m&lt;&#x2F;span&gt; state&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;state&lt;&#x2F;span&gt; NEW&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;m&lt;&#x2F;span&gt; tcp&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;dport&lt;&#x2F;span&gt; 22&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;p&lt;&#x2F;span&gt; tcp&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;m&lt;&#x2F;span&gt; tcp&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;dport&lt;&#x2F;span&gt; 80&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;p&lt;&#x2F;span&gt; tcp&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;m&lt;&#x2F;span&gt; tcp&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;dport&lt;&#x2F;span&gt; 443&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;i&lt;&#x2F;span&gt; eth0&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;p&lt;&#x2F;span&gt; ah&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;i&lt;&#x2F;span&gt; eth0&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;p&lt;&#x2F;span&gt; esp&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;i&lt;&#x2F;span&gt; eth0&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;p&lt;&#x2F;span&gt; udp&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;m&lt;&#x2F;span&gt; udp&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;dport&lt;&#x2F;span&gt; 500&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;i&lt;&#x2F;span&gt; eth0&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;p&lt;&#x2F;span&gt; udp&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;m&lt;&#x2F;span&gt; udp&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;dport&lt;&#x2F;span&gt; 4500&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; INPUT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; REJECT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;reject-with&lt;&#x2F;span&gt; icmp-host-prohibited&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; FORWARD&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;i&lt;&#x2F;span&gt; eth0&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;m&lt;&#x2F;span&gt; policy&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;dir&lt;&#x2F;span&gt; in&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;pol&lt;&#x2F;span&gt; ipsec&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; FORWARD&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;d&lt;&#x2F;span&gt; 10.10.0.0&#x2F;24&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;o&lt;&#x2F;span&gt; eth0&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;m&lt;&#x2F;span&gt; policy&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;dir&lt;&#x2F;span&gt; out&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;pol&lt;&#x2F;span&gt; ipsec&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; ACCEPT&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;-A&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; FORWARD&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;j&lt;&#x2F;span&gt; REJECT&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;reject-with&lt;&#x2F;span&gt; icmp-host-prohibited&lt;&#x2F;span&gt;
&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;COMMIT&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;重启防火墙，使规则生效。&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;systemctl restart iptables&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;配置strongswan 输出日志，方便测试，测试完成后，关闭该日志&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;vim &#x2F;etc&#x2F;strongswan&#x2F;strongswan.d&#x2F;charon.conf&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;charon&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-meta z-group z-expansion z-brace z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-brace z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt;
    filelog &lt;span class=&quot;z-meta z-group z-expansion z-brace z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-brace z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt;
        charon-debug-log &lt;span class=&quot;z-meta z-group z-expansion z-brace z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-brace z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt;
            path = &#x2F;var&#x2F;log&#x2F;charon_debug.log
            time_format = &lt;span class=&quot;z-meta z-group z-expansion z-job z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-job z-shell&quot;&gt;%&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;b&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-expansion z-job z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-job z-shell&quot;&gt;%&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;e&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-expansion z-job z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-job z-shell&quot;&gt;%&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;T&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
            default = 2
            mgr = 0
            net = 1
            enc = 1
            asn = 1
            job = 1
            ike_name = yes
            append = no
            flush_line = yes
        &lt;span class=&quot;z-punctuation z-section z-expansion z-brace z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
    &lt;span class=&quot;z-punctuation z-section z-expansion z-brace z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
    &lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;这里是其它设置......&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-brace z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;启动strongswan&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;systemctl start strongswan&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;si-zui-hou-zhuang-tai-jian-cha-ji-ce-shi&quot;&gt;四、最后状态检查 及 测试&lt;&#x2F;h2&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;systemctl status nginx
systemctl status iptables
systemctl status strongswan
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;到阿里云控制台打开白名单，包含：&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;tcp 500
tcp 4500
全部 GRE
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;windows  macos ios 直接配置 vpn即可，&lt;&#x2F;p&gt;
&lt;p&gt;Android 系统需要下载客户端程序，前往官网下载 &lt;a rel=&quot;noopener nofollow noreferrer&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;download.strongswan.org&#x2F;Android&#x2F;?C=M;O=D&quot;&gt;最新版 apk 程序&lt;&#x2F;a&gt;。
测试完成后，记得关闭 strongswan 日志, 重启 strongswan。&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;systemctl restart strongswan&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;设置开机自启动，完工。&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;systemctl enable iptables
systemctl enable strongswan
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;wu-wei-hu&quot;&gt;五、维护&lt;&#x2F;h2&gt;
&lt;p&gt;查看证书情况&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;certbot certificates&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;证书手动更新&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;certbot renew --cert-name domain --dry-run&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;certbot --nginx certonly -n -d domain&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;第二种更新方法须安装 &lt;code&gt;python3-certbot-nginx&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>理解矩阵</title>
        <published>2019-02-15T00:00:00+00:00</published>
        <updated>2019-02-15T00:00:00+00:00</updated>
        <author>
          <name>Unknown</name>
        </author>
        <link rel="alternate" href="https://www.freeopen.tech/matrix/" type="text/html"/>
        <id>https://www.freeopen.tech/matrix/</id>
        
        <content type="html">&lt;blockquote&gt;
&lt;p&gt;为阅读方便，将孟岩的《理解矩阵》一、二、三篇合为一篇，在保证内容完备的前提下删除少量不相干内容。遇到这篇文章是缘分，它是开启线性代数学习的一把钥匙，不管你是初学者还是老手，有幸读到这篇，一定会有茅塞顿开的感觉。&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;&lt;a rel=&quot;noopener nofollow noreferrer&quot; target=&quot;_blank&quot; href=&quot;http:&#x2F;&#x2F;blog.csdn.net&#x2F;myan&#x2F;article&#x2F;details&#x2F;647511&quot;&gt;原文&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;一般工科学生初学线性代数，通常都会感到困难。这种情形在国内外皆然。瑞典数学家 Lars Garding 在其名著 Encounter with Mathematics 中说：“如果不熟悉线性代数的概念，要去学习自然科学，现在看来就和文盲差不多。”，然而“按照现行的国际标准，线性代数是通过公理化来表述的，它是第二代数学模型，…，这就带来了教学上的困难。”事实上，当我们开始学习线性代数的时候，不知不觉就进入了“第二代数学模型”的范畴当中，这意味着数学的表述方式和抽象性有了一次全面的进化，对于从小一直在“第一代数学模型”，即以实用为导向的、具体的数学模型中学习的我们来说，在没有并明确告知的情况下进行如此剧烈的 paradigm shift，不感到困难才是奇怪的。&lt;&#x2F;p&gt;
&lt;p&gt;大部分工科学生，往往是在学习了一些后继课程，如数值分析、数学规划、矩阵论之后，才逐渐能够理解和熟练运用线性代数。即便如此，不少人即使能够很熟练地以线性代数为工具进行科研和应用工作，但对于很多这门课程的初学者提出的、看上去是很基础的问题却并不清楚。比如说：&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;矩阵究竟是什么东西？向量可以被认为是具有 $n$个相互独立的性质（维度）的对象的表示，矩阵又是什么呢？我们如果认为矩阵是一组列（行）向量组成的新的复合向量的展开式，那么为什么这种展开式具有如此广泛的应用？特别是，为什么偏偏二维的展开式如此有用？如果矩阵中每一个元素又是一个向量，那么我们再展开一次，变成三维的立方阵，是不是更有用？&lt;&#x2F;li&gt;
&lt;li&gt;矩阵的乘法规则究竟为什么这样规定？为什么这样一种怪异的乘法规则却能够在实践中发挥如此巨大的功效？很多看上去似乎是完全不相关的问题，最后竟然都归结到矩阵的乘法，这难道不是很奇妙的事情？难道在矩阵乘法那看上去莫名其妙的规则下面，包含着世界的某些本质规律？如果是的话，这些本质规律是什么？&lt;&#x2F;li&gt;
&lt;li&gt;行列式究竟是一个什么东西？为什么会有如此怪异的计算规则？行列式与其对应方阵本质上是什么关系？为什么只有方阵才有对应的行列式，而一般矩阵就没有（不要觉得这个问题很蠢，如果必要，针对$m\times n$矩阵定义行列式不是做不到的，之所以不做，是因为没有这个必要，但是为什么没有这个必要）？而且，行列式的计算规则，看上去跟矩阵的任何计算规则都没有直观的联系，为什么又在很多方面决定了矩阵的性质？难道这一切仅是巧合？&lt;&#x2F;li&gt;
&lt;li&gt;矩阵为什么可以分块计算？分块计算这件事情看上去是那么随意，为什么竟是可行的？&lt;&#x2F;li&gt;
&lt;li&gt;对于矩阵转置运算 $A^T$ ，有 $(AB)^T=B^TA^T$，对于矩阵求逆运算 $A^{-1}$ ，有 $(AB)^{-1}=B^{-1}A^{-1}$。两个看上去完全没有什么关系的运算，为什么有着类似的性质？这仅仅是巧合吗？&lt;&#x2F;li&gt;
&lt;li&gt;为什么说 $P^{-1}AP$ 得到的矩阵与 $A$ 矩阵“相似”？这里的“相似”是什么意思？&lt;&#x2F;li&gt;
&lt;li&gt;特征值和特征向量的本质是什么？它们定义就让人很惊讶，因为 $Ax=\lambda x$，一个诺大的矩阵的效应，竟然不过相当于一个小小的数 $\lambda$，确实有点奇妙。但何至于用“特征”甚至“本征”来界定？它们刻划的究竟是什么？&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;这样的一类问题，经常让使用线性代数已经很多年的人都感到为难。就好像大人面对小孩子的刨根问底，最后总会迫不得已地说“就这样吧，到此为止”一样，面对这样的问题，很多老手们最后也只能用：“就是这么规定的，你接受并且记住就好”来搪塞。然而，这样的问题如果不能获得回答，线性代数对于我们来说就是一个粗暴的、不讲道理的、莫名其妙的规则集合，我们会感到，自己并不是在学习一门学问，而是被不由分说地“抛到”一个强制的世界中，只是在考试的皮鞭挥舞之下被迫赶路，全然无法领略其中的美妙、和谐与统一。直到多年以后，我们已经发觉这门学问如此的有用，却仍然会非常迷惑：怎么这么凑巧？&lt;&#x2F;p&gt;
&lt;p&gt;我认为，这是我们的线性代数教学中直觉性丧失的后果。上述这些涉及到“如何能”、“怎么会”的问题，仅仅通过纯粹的数学证明来回答，是不能令提问者满意的。比如，如果你通过一般的证明方法论证了矩阵分块运算确实可行，那么这并不能够让提问者的疑惑得到解决。他们真正的困惑是：矩阵分块运算为什么竟然是可行的？究竟只是凑巧，还是说这是由矩阵这种对象的某种本质所必然决定的？如果是后者，那么矩阵的这些本质是什么？只要对上述那些问题稍加考虑，我们就会发现，所有这些问题都不是单纯依靠数学证明所能够解决的。像我们的教科书那样，凡事用数学证明，最后培养出来的学生，只能熟练地使用工具，却欠缺真正意义上的理解。&lt;&#x2F;p&gt;
&lt;p&gt;自从 1930 年代法国布尔巴基学派兴起以来，数学的公理化、系统性描述已经获得巨大的成功，这使得我们接受的数学教育在严谨性上大大提高。然而数学公理化的一个备受争议的副作用，就是一般数学教育中直觉性的丧失。数学家们似乎认为直觉性与抽象性是矛盾的，因此毫不犹豫地牺牲掉前者。然而包括我本人在内的很多人都对此表示怀疑，我们不认为直觉性与抽象性一定相互矛盾，特别是在数学教育中和数学教材中，帮助学生建立直觉，有助于它们理解那些抽象的概念，进而理解数学的本质。反之，如果一味注重形式上的严格性，学生就好像被迫进行钻火圈表演的小白鼠一样，变成枯燥的规则的奴隶。&lt;&#x2F;p&gt;
&lt;p&gt;对于线性代数的类似上述所提到的一些直觉性的问题，两年多来我断断续续地反复思考了四、五次，为此阅读了好几本国内外线性代数、数值分析、代数和数学通论性书籍，其中像前苏联的名著《数学：它的内容、方法和意义》、龚昇教授的《线性代数五讲》、前面提到的 Encounter with Mathematics（《数学概观》）以及 Thomas A. Garrity 的《数学拾遗》都给我很大的启发。不过即使如此，我对这个主题的认识也经历了好几次自我否定。比如以前思考的一些结论曾经写在自己的 blog 里，但是现在看来，这些结论基本上都是错误的。因此打算把自己现在的有关理解比较完整地记录下来，一方面是因为我觉得现在的理解比较成熟了，可以拿出来与别人探讨，向别人请教。另一方面，如果以后再有进一步的认识，把现在的理解给推翻了，那现在写的这个 snapshot 也是很有意义的。&lt;&#x2F;p&gt;
&lt;p&gt;首先说说空间(space)，这个概念是现代数学的命根子之一，从拓扑空间开始，一步步往上加定义，可以形成很多空间。线形空间其实还是比较初级的，如果在里面定义了范数，就成了赋范线性空间。赋范线性空间满足完备性，就成了巴那赫空间；赋范线性空间中定义角度，就有了内积空间，内积空间再满足完备性，就得到希尔伯特空间。&lt;&#x2F;p&gt;
&lt;p&gt;总之，空间有很多种。你要是去看某种空间的数学定义，大致都是“存在一个集合，在这个集合上定义某某概念，然后满足某些性质”，就可以被称为空间。这未免有点奇怪，为什么要用“空间”来称呼一些这样的集合呢？大家将会看到，其实这是很有道理的。&lt;&#x2F;p&gt;
&lt;p&gt;我们一般人最熟悉的空间，毫无疑问就是我们生活在其中的（按照牛顿的绝对时空观）的三维空间，从数学上说，这是一个三维的欧几里德空间，我们先不管那么多，先看看我们熟悉的这样一个空间有些什么最基本的特点。仔细想想我们就会知道，这个三维的空间：&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;由很多（实际上是无穷多个）位置点组成；&lt;&#x2F;li&gt;
&lt;li&gt;这些点之间存在相对的关系；&lt;&#x2F;li&gt;
&lt;li&gt;可以在空间中定义长度、角度；&lt;&#x2F;li&gt;
&lt;li&gt;&lt;font color=red&gt;这个空间可以容纳运动，这里我们所说的运动是从一个点到另一个点的移动（变换），而不是微积分意义上的“连续”性的运动。&lt;&#x2F;font&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;上面的这些性质中，最最关键的是第4条。第1、2条只能说是空间的基础，不算是空间特有的性质，凡是讨论数学问题，都得有一个集合，大多数还得在这个集合上定义一些结构（关系），并不是说有了这些就算是空间。而第3条太特殊，其他的空间不需要具备，更不是关键的性质。只有第4条是空间的本质，也就是说，容纳运动是空间的本质特征。&lt;&#x2F;p&gt;
&lt;p&gt;认识到了这些，我们就可以把我们关于三维空间的认识扩展到其他的空间。&lt;font color=red&gt;事实上，不管是什么空间，都必须容纳和支持在其中发生的符合规则的运动（变换）。你会发现，在某种空间中往往会存在一种相对应的变换，比如拓扑空间中有拓扑变换，线性空间中有线性变换，仿射空间中有仿射变换，其实这些变换都只不过是对应空间中允许的运动形式而已。&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;因此只要知道，&lt;font color=red&gt;“空间”是容纳运动的一个对象集合，而变换则规定了对应空间的运动。&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;下面我们来看看线性空间。线性空间的定义任何一本书上都有，但是既然我们承认线性空间是个空间，那么有两个最基本的问题必须首先得到解决，那就是：&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;空间是一个对象集合，线性空间也是空间，所以也是一个对象集合。那么线性空间是什么样的对象的集合？或者说，线性空间中的对象有什么共同点吗？&lt;&#x2F;li&gt;
&lt;li&gt;线性空间中的运动如何表述的？也就是，线性变换是如何表示的？&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;我们先来回答第一个问题，回答这个问题的时候其实是不用拐弯抹角的，可以直截了当的给出答案。&lt;font color=red&gt;线性空间中的任何一个对象，通过选取基和坐标的办法，都可以表达为向量的形式。&lt;&#x2F;font&gt;通常的向量空间我就不说了，举两个不那么平凡的例子：&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;最高次项不大于 $n$ 次的多项式的全体构成一个线性空间，也就是说，这个线性空间中的每一个对象是一个多项式。如果我们以 $x^0,x^1,…,x^n$ 为基，那么任何一个这样的多项式都可以表达为一组 $n+1$ 维向量，其中的每一个分量 $a_i$ 其实就是多项式中 $x^{(i-1)}$ 项的系数。值得说明的是，基的选取有多种办法，只要所选取的那一组基线性无关就可以。这要用到后面提到的概念了，所以这里先不说，提一下而已。&lt;&#x2F;li&gt;
&lt;li&gt;闭区间 $[a,b]$ 上的 $n$ 阶连续可微函数的全体，构成一个线性空间。也就是说，这个线性空间的每一个对象是一个连续函数。对于其中任何一个连续函数，根据魏尔斯特拉斯定理，一定可以找到最高次项不大于 $n$ 的多项式函数，使之与该连续函数的差为 $0$ ，也就是说，完全相等。这样就把问题归结为例 1 了。后面就不用再重复了。&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;所以说，向量是很厉害的，只要你找到合适的基，用向量可以表示线性空间里任何一个对象。这里头大有文章，因为向量表面上只是一列数，但是其实由于它的有序性，所以除了这些数本身携带的信息之外，还可以在每个数的对应位置上携带信息。为什么在程序设计中数组最简单，却又威力无穷呢？根本原因就在于此。这是另一个问题了，这里就不说了。&lt;&#x2F;p&gt;
&lt;p&gt;下面来回答第二个问题，这个问题的回答会涉及到线性代数的一个最根本的问题。&lt;&#x2F;p&gt;
&lt;p&gt;线性空间中的运动，被称为线性变换。也就是说，你从线性空间中的一个点运动到任意的另外一个点，都可以通过一个线性变换来完成。那么，线性变换如何表示呢？&lt;font color=red&gt;很有意思，在线性空间中，当你选定一组基之后，不仅可以用一个向量来描述空间中的任何一个对象，而且可以用矩阵来描述该空间中的任何一个运动（变换）。而使某个对象发生对应运动的方法，就是用代表那个运动的矩阵，乘以代表那个对象的向量。&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;简而言之，&lt;font color=red&gt;在线性空间中选定基之后，向量刻画对象，矩阵刻画对象的运动，用矩阵与向量的乘法施加运动。&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;是的，矩阵的本质是运动的描述。如果以后有人问你矩阵是什么，那么你就可以响亮地告诉他，&lt;font color=red&gt;&lt;u&gt;矩阵的本质是运动的描述&lt;&#x2F;u&gt;&lt;&#x2F;font&gt;。&lt;&#x2F;p&gt;
&lt;p&gt;可是多么有意思啊，向量本身不是也可以看成是$n\times 1$矩阵吗？这实在是很奇妙，&lt;font color=red&gt;一个空间中的对象和运动竟然可以用相类同的方式表示&lt;&#x2F;font&gt;。能说这是巧合吗？如果是巧合的话，那可真是幸运的巧合！可以说，线性代数中大多数奇妙的性质，均与这个巧合有直接的关系。&lt;&#x2F;p&gt;
&lt;p&gt;因为运动这个概念，在数学和物理里是跟微积分联系在一起的。我们学习微积分的时候，总会有人照本宣科地告诉你，初等数学是研究常量的数学，是研究静态的数学，高等数学是变量的数学，是研究运动的数学。大家口口相传，差不多人人都知道这句话。但是真知道这句话说的是什么意思的人，好像也不多。简而言之，在我们人类的经验里，运动是一个连续过程，从 $A$ 点到 $B$ 点，就算走得最快的光，也是需要一个时间来&lt;u&gt;&lt;strong&gt;逐点&lt;&#x2F;strong&gt;&lt;&#x2F;u&gt;地经过 $AB$ 之间的路径，这就带来了连续性的概念。而连续这个事情，如果不定义极限的概念，根本就解释不了。古希腊人的数学非常强，但就是缺乏极限观念，所以解释不了运动，被芝诺的那些著名悖论（飞箭不动、飞毛腿阿喀琉斯跑不过乌龟等四个悖论）搞得死去活来。因为这篇文章不是讲微积分的，所以我就不多说了。有兴趣的读者可以去看看齐民友教授写的《重温微积分》。我就是读了这本书开头的部分，才明白“高等数学是研究运动的数学”这句话的道理。&lt;&#x2F;p&gt;
&lt;p&gt;不过在我这个《理解矩阵》的文章里，“运动”的概念不是微积分中的连续性的运动，而是瞬间发生的变化。比如这个时刻在$A$点，经过一个“运动”，一下子就“跃迁”到了 $B$ 点，其中不需要经过 $A$ 点与 $B$ 点之间的任何一个点。这样的“运动”，或者说“&lt;u&gt;&lt;strong&gt;跃迁&lt;&#x2F;strong&gt;&lt;&#x2F;u&gt;”，是违反我们日常的经验的。不过了解一点量子物理常识的人，就会立刻指出，量子（例如电子）在不同的能量级轨道上跳跃，就是瞬间发生的，具有这样一种跃迁行为。所以说，自然界中并不是没有这种运动现象，只不过宏观上我们观察不到。但是不管怎么说，“运动”这个词用在这里，还是容易产生歧义的，说得更确切些，应该是“跃迁”。因此这句话可以改成：&lt;&#x2F;p&gt;
&lt;p&gt;&lt;font color=red&gt;“矩阵是线性空间里跃迁的描述”。&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;可是这样说又太物理，也就是说太具体，而不够数学，也就是说不够抽象。因此我们最后换用一个正牌的数学术语——&lt;u&gt;&lt;strong&gt;变换&lt;&#x2F;strong&gt;&lt;&#x2F;u&gt;，来描述这个事情。这样一说，大家就应该明白了，&lt;font color=red&gt;所谓变换，其实就是空间里从一个点（元素&#x2F;对象）到另一个点（元素&#x2F;对象）的跃迁&lt;&#x2F;font&gt;。比如说，拓扑变换，就是在拓扑空间里从一个点到另一个点的跃迁。再比如说，仿射变换，就是在仿射空间里从一个点到另一个点的跃迁。附带说一下，这个仿射空间跟向量空间是亲兄弟。做计算机图形学的朋友都知道，尽管描述一个三维对象只需要三维向量，但所有的计算机图形学变换矩阵都是 $4\times4$ 的。说其原因，很多书上都写着“为了使用中方便”，这在我看来简直就是企图蒙混过关。真正的原因，是因为在计算机图形学里应用的图形变换，实际上是在仿射空间而不是向量空间中进行的。想想看，在向量空间里一个向量平行移动以后仍是相同的那个向量，而现实世界等长的两个平行线段当然不能被认为同一个东西，所以计算机图形学的生存空间实际上是仿射空间。而仿射变换的矩阵表示根本就是 $4\times4$ 的。又扯远了，有兴趣的读者可以去看《计算机图形学——几何工具算法详解》。&lt;&#x2F;p&gt;
&lt;p&gt;一旦我们理解了“变换”这个概念，矩阵的定义就变成：&lt;&#x2F;p&gt;
&lt;p&gt;&lt;font color=red&gt;“矩阵是线性空间里的变换的描述。”&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;到这里为止，我们终于得到了一个看上去比较数学的定义。不过还要多说几句。
教材上一般是这么说的，在一个线性空间 $V$ 里的一个线性变换 $T$，当选定一组基之后，就可以表示为矩阵。
因此我们还要说清楚到底什么是线性变换，什么是基，什么叫选定一组基。线性变换的定义是很简单的，设有一种变换 $T$，
使得对于线性空间 $V$ 中间任何两个不相同的对象 $x$ 和 $y$，以及任意实数 $a$ 和 $b$，有：
$T(ax+by)=aT(x)+bT(y)$，那么就称 $T$ 为线性变换。&lt;&#x2F;p&gt;
&lt;p&gt;定义都是这么写的，但是光看定义还得不到直觉的理解。线性变换究竟是一种什么样的变换？
我们刚才说了，变换是从空间的一个点跃迁到另一个点，而线性变换，
就是从一个线性空间 $V$ 的某一个点跃迁到另一个线性空间 $W$ 的另一个点的运动。
这句话里蕴含着一层意思，就是说一个点不仅可以变换到同一个线性空间中的另一个点，而且可以变换到另一个线性空间中的另一个点去。
不管你怎么变，只要变换前后都是线性空间中的对象，这个变换就一定是线性变换，也就一定可以用一个非奇异矩阵来描述。而你用一个非奇异矩阵去描述的一个变换，一定是一个线性变换。
有的人可能要问，这里为什么要强调非奇异矩阵？所谓非奇异，只对方阵有意义，那么非方阵的情况怎么样？这个说起来就会比较冗长了，最后要把线性变换作为一种映射，并且讨论其映射性质，以及线性变换的核与像等概念才能彻底讲清楚。
我觉得这个不算是重点，如果确实有时间的话，以后写一点。
&lt;strong&gt;以下我们只探讨最常用、最有用的一种变换，就是在同一个线性空间之内的线性变换。
也就是说，下面所说的矩阵，不作说明的话，就是方阵，而且是非奇异方阵。
学习一门学问，最重要的是把握主干内容，迅速建立对于这门学问的整体概念，不必一开始就考虑所有的细枝末节和特殊情况，自乱阵脚。&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;接着往下说，什么是基呢？这个问题在后面还要大讲一番，这里只要&lt;font color=red&gt;把基看成是线性空间里的坐标系就可以了&lt;&#x2F;font&gt;。注意是坐标系，不是坐标值，这两者可是一个“对立矛盾统一体”。这样一来，“选定一组基”就是说在线性空间里选定一个坐标系。就这意思。&lt;&#x2F;p&gt;
&lt;p&gt;好，最后我们把矩阵的定义完善如下：&lt;&#x2F;p&gt;
&lt;p&gt;&lt;font color=red&gt;“矩阵是线性空间中的线性变换的一个描述。在一个线性空间中，只要我们选定一组基，那么对于任何一个线性变换，都能够用一个确定的矩阵来加以描述。”&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;理解这句话的关键，在于把“线性变换”与“线性变换的一个描述”区别开&lt;&#x2F;strong&gt;。一个是那个对象，一个是对那个对象的表述。就好像我们熟悉的面向对象编程中，一个对象可以有多个引用，每个引用可以叫不同的名字，但都是指的同一个对象。如果还不形象，那就干脆来个很俗的类比。&lt;&#x2F;p&gt;
&lt;p&gt;比如有一头猪，你打算给它拍照片，只要你给照相机选定了一个镜头位置，那么就可以给这头猪拍一张照片。这个照片可以看成是这头猪的一个描述，但只是一个片面的的描述，因为换一个镜头位置给这头猪拍照，能得到一张不同的照片，也是这头猪的另一个片面的描述。所有这样照出来的照片都是这同一头猪的描述，但是又都不是这头猪本身。&lt;&#x2F;p&gt;
&lt;p&gt;&lt;font color=red&gt;同样的，对于一个线性变换，只要你选定一组基，那么就可以找到一个矩阵来描述这个线性变换。换一组基，就得到一个不同的矩阵。所有这些矩阵都是这同一个线性变换的描述，但又都不是线性变换本身。&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;但是这样的话，问题就来了如果你给我两张猪的照片，我怎么知道这两张照片上的是同一头猪呢？同样的，你给我两个矩阵，我怎么知道这两个矩阵是描述的同一个线性变换呢？如果是同一个线性变换的不同的矩阵描述，那就是本家兄弟了，见面不认识，岂不成了笑话。&lt;&#x2F;p&gt;
&lt;p&gt;好在，我们可以找到同一个线性变换的矩阵兄弟们的一个性质，那就是：
若矩阵$A$与$B$是同一个线性变换的两个不同的描述（之所以会不同，是因为选定了不同的基，也就是选定了不同的坐标系），则一定能找到一个非奇异矩阵$P$，使得$A、B$之间满足这样的关系：
$$A=P^{-1}BP$$&lt;&#x2F;p&gt;
&lt;p&gt;线性代数稍微熟一点的读者一下就看出来，这就是相似矩阵的定义。没错，&lt;font color=red&gt;所谓相似矩阵，就是同一个线性变换的不同的描述矩阵&lt;&#x2F;font&gt;。按照这个定义，同一头猪的不同角度的照片也可以成为相似照片。俗了一点，不过能让人明白。&lt;&#x2F;p&gt;
&lt;p&gt;而在上面式子里那个矩阵$P$，其实就是$A$矩阵所基于的基与$B$矩阵所基于的基这两组基之间的一个变换关系。关于这个结论，可以用一种非常直觉的方法来证明（而不是一般教科书上那种形式上的证明），如果有时间的话，我以后在 blog 里补充这个证明。&lt;&#x2F;p&gt;
&lt;p&gt;这个发现太重要了。&lt;font color=red&gt;原来一族相似矩阵都是同一个线性变换的描述啊！&lt;&#x2F;font&gt;难怪这么重要！工科研究生课程中有矩阵论、矩阵分析等课程，其中讲了各种各样的相似变换，比如什么相似标准型，对角化之类的内容，都要求变换以后得到的那个矩阵与先前的那个矩阵式相似的，为什么这么要求？因为只有这样要求，才能保证变换前后的两个矩阵是描述同一个线性变换的。当然，同一个线性变换的不同矩阵描述，从实际运算性质来看并不是不分好环的。有些描述矩阵就比其他的矩阵性质好得多。这很容易理解，同一头猪的照片也有美丑之分嘛。所以矩阵的相似变换可以把一个比较丑的矩阵变成一个比较美的矩阵，而保证这两个矩阵都是描述了同一个线性变换。&lt;&#x2F;p&gt;
&lt;p&gt;这样一来，矩阵作为线性变换描述的一面，基本上说清楚了。
但是，事情没有那么简单，或者说，线性代数还有比这更奇妙的性质，那就是，
&lt;font color=red&gt;矩阵不仅可以作为线性变换的描述，而且可以作为一组基的描述。
而作为变换的矩阵，不但可以把线性空间中的一个点给变换到另一个点去，
而且也能够把线性空间中的一个坐标系（基）换到另一个坐标系（基）去。&lt;&#x2F;font&gt;
而且，变换点与变换坐标系，具有异曲同工的效果。
线性代数里最有趣的奥妙，就蕴含在其中。
理解了这些内容，线性代数里很多定理和规则会变得更加清晰、直觉。&lt;&#x2F;p&gt;
&lt;p&gt;首先来总结一下前面两部分的一些主要结论：&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;首先有空间，空间可以容纳对象运动的。一种空间对应一类对象。&lt;&#x2F;li&gt;
&lt;li&gt;有一种空间叫线性空间，线性空间是容纳向量对象运动的。&lt;&#x2F;li&gt;
&lt;li&gt;运动是瞬时的，因此也被称为变换。&lt;&#x2F;li&gt;
&lt;li&gt;矩阵是线性空间中运动（变换）的描述。&lt;&#x2F;li&gt;
&lt;li&gt;矩阵与向量相乘，就是实施运动（变换）的过程。&lt;&#x2F;li&gt;
&lt;li&gt;同一个变换，在不同的坐标系下表现为不同的矩阵，但是它们的本质是一样的，所以本征值相同。&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;下面让我们把视力集中到一点以改变我们以往看待矩阵的方式。我们知道，线性空间里的基本对象是向量，而向量是这么表示的：&lt;&#x2F;p&gt;
&lt;p&gt;$$[a_1,a_2,a_3,…,a_n]$$&lt;&#x2F;p&gt;
&lt;p&gt;矩阵呢？矩阵是这么表示的：&lt;&#x2F;p&gt;
&lt;p&gt;$$\begin{bmatrix}
a_{11}&amp;amp;a_{12}&amp;amp;a_{13}&amp;amp;\cdots&amp;amp;a_{1n} \\
a_{21}&amp;amp;a_{22}&amp;amp;a_{23}&amp;amp;\cdots&amp;amp;a_{2n} \\
\vdots &amp;amp; \vdots &amp;amp; \vdots &amp;amp; \ddots &amp;amp; \vdots \\
a_{n1}&amp;amp;a_{n2}&amp;amp;a_{n3}&amp;amp;\cdots&amp;amp;a_{nn} \\
\end{bmatrix}$$&lt;&#x2F;p&gt;
&lt;p&gt;不用太聪明，我们就能看出来，矩阵是一组向量组成的。特别的，$n$ 维线性空间里的方阵是由 $n$ 个 $n$ 维向量组成的。
我们在这里只讨论这个 $n$ 阶的、非奇异的方阵，因为理解它就是理解矩阵的关键，它才是一般情况，而其他矩阵都是意外，都是不得不对付的讨厌状况，大可以放在一边。
这里多一句嘴，学习东西要抓住主流，不要纠缠于旁支末节。很可惜我们的教材课本大多数都是把主线埋没在细节中的，搞得大家还没明白怎么回事就先被灌晕了。比如数学分析，明明最要紧的观念是说，一个对象可以表达为无穷多个合理选择的对象的线性和，这个概念是贯穿始终的，也是数学分析的精华。但是课本里自始至终不讲这句话，反正就是让你做吉米多维奇，掌握一大堆解偏题的技巧，记住各种特殊情况，两类间断点，怪异的可微和可积条件（谁还记得柯西条件、迪里赫莱条件…？），最后考试一过，一切忘光光。要我说，还不如反复强调这一个事情，把它深深刻在脑子里，别的东西忘了就忘了，真碰到问题了，再查数学手册嘛，何必因小失大呢？&lt;&#x2F;p&gt;
&lt;p&gt;言归正传。如果一组向量是彼此线性无关的话，那么它们就可以成为度量这个线性空间的一组基，从而事实上成为一个坐标系体系，其中每一个向量都躺在一根坐标轴上，并且成为那根坐标轴上的基本度量单位（长度 1）。&lt;&#x2F;p&gt;
&lt;p&gt;现在到了关键的一步。看上去矩阵就是由一组向量组成的，而且如果矩阵非奇异的话（我说了，只考虑这种情况），那么组成这个矩阵的那一组向量也就是线性无关的了，也就可以成为度量线性空间的一个坐标系。结论：&lt;font color=red&gt;矩阵描述了一个坐标系&lt;&#x2F;font&gt;。&lt;&#x2F;p&gt;
&lt;p&gt;“慢着！”，你嚷嚷起来了，“你这个骗子！你不是说过，矩阵就是运动吗？怎么这会矩阵又是坐标系了？”&lt;&#x2F;p&gt;
&lt;p&gt;嗯，所以我说到了关键的一步。我并没有骗人，之所以矩阵又是运动，又是坐标系，那是因为——&lt;&#x2F;p&gt;
&lt;p&gt;&lt;font color=red&gt;“运动等价于坐标系变换”。&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;对不起，这话其实不准确，我只是想让你印象深刻。准确的说法是：&lt;&#x2F;p&gt;
&lt;p&gt;&lt;font color=red&gt;“对象的变换等价于坐标系的变换”。&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;或者：&lt;&#x2F;p&gt;
&lt;p&gt;&lt;font color=red&gt;“固定坐标系下一个对象的变换等价于固定对象所处的坐标系变换。”&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;说白了就是：&lt;&#x2F;p&gt;
&lt;p&gt;&lt;font color=red&gt;“运动是相对的。”&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;让我们想想，达成同一个变换的结果，比如把点 $(1,1)$ 变到点 $(2,3)$ 去，你可以有两种做法。第一，坐标系不动，点动，把 $(1,1)$ 点挪到 $(2,3)$ 去。第二，点不动，变坐标系，让 $x$ 轴的度量（单位向量）变成原来的 $1\over 2$，让 $y$ 轴的度量（单位向量）变成原先的 $1\over 3$，这样点还是那个点，可是点的坐标就变成 $(2,3)$ 了。方式不同，结果一样。&lt;&#x2F;p&gt;
&lt;p&gt;从第一个方式来看，把矩阵看成是运动描述，矩阵与向量相乘就是使向量（点）运动的过程。在这个方式下，
$Ma=b$ 的意思是：&lt;&#x2F;p&gt;
&lt;p&gt;“向量 $a$ 经过矩阵 $M$ 所描述的变换，变成了向量 $b$。”&lt;&#x2F;p&gt;
&lt;p&gt;而从第二个方式来看，矩阵 $M$ 描述了一个坐标系，姑且也称之为 $M$。那么：
$Ma=b$ 的意思是：&lt;&#x2F;p&gt;
&lt;p&gt;&lt;font color=red&gt;“有一个向量，它在坐标系 $M$ 的度量下得到的度量结果向量为 $a$，那么它在坐标系 $I$ 的度量下，这个向量的度量结果是 $b$。”&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;这里的 $I$ 是指单位矩阵，就是主对角线是 $1$，其他为零的矩阵。&lt;&#x2F;p&gt;
&lt;p&gt;而这两个方式本质上是等价的。
我希望你务必理解这一点，因为这是本篇的关键。&lt;&#x2F;p&gt;
&lt;p&gt;正因为是关键，所以我得再解释一下。
在 $M$ 为坐标系的意义下，如果把 $M$ 放在一个向量 $a$ 的前面，形成 $Ma$ 的样式，我们可以认为这是&lt;font color=red&gt;对向量 $a$ 的一个环境声明&lt;&#x2F;font&gt;。它相当于是说：&lt;&#x2F;p&gt;
&lt;p&gt;“注意了！这里有一个向量，它在坐标系 $M$ 中度量，得到的度量结果可以表达为 $a$。可是它在别的坐标系里度量的话，就会得到不同的结果。为了明确，我把 $M$ 放在前面，让你明白，这是该向量在坐标系 $M$ 中度量的结果。”&lt;&#x2F;p&gt;
&lt;p&gt;那么我们再看孤零零的向量 $\vec{b}$：
$$\vec{b}$$
多看几遍，你没看出来吗？它其实不是 $b$，它是：
$$Ib$$
也就是说：“在单位坐标系，也就是我们通常说的直角坐标系 $I$ 中，有一个向量，度量的结果是 $b$。”&lt;&#x2F;p&gt;
&lt;p&gt;而 $Ma=Ib$ 的意思就是说：&lt;&#x2F;p&gt;
&lt;p&gt;“在 $M$ 坐标系里量出来的向量 $a$，跟在 $I$ 坐标系里量出来的向量 $b$，其实根本就是一个向量啊！”&lt;&#x2F;p&gt;
&lt;p&gt;这哪里是什么乘法计算，根本就是身份识别嘛。&lt;&#x2F;p&gt;
&lt;p&gt;从这个意义上我们重新理解一下向量。向量这个东西客观存在，但是要把它表示出来，就要把它放在一个坐标系中去度量它，然后把度量的结果（向量在各个坐标轴上的投影值）按一定顺序列在一起，就成了我们平时所见的向量表示形式。
你选择的坐标系（基）不同，得出来的向量的表示就不同。
向量还是那个向量，选择的坐标系不同，其表示方式就不同。
因此，按道理来说，每写出一个向量的表示，都应该声明一下这个表示是在哪个坐标系中度量出来的。
表示的方式，就是 $Ma$，也就是说，有一个向量，在 $M$ 矩阵表示的坐标系中度量出来的结果为 $a$。我们平时说一个向量是 $[2,3,5,7]^T$，隐含着是说，这个向量在$I$坐标系中的度量结果是 $[2,3,5,7]^T$，因此，这个形式反而是一种简化了的特殊情况。&lt;&#x2F;p&gt;
&lt;p&gt;注意到，$M$ 矩阵表示出来的那个坐标系，由一组基组成，而那组基也是由向量组成的，
同样存在这组向量是在哪个坐标系下度量而成的问题。
也就是说，表述一个矩阵的一般方法，也应该要指明其所处的基准坐标系。
所谓$M$，其实是 $IM$，也就是说，$M$ 中那组基的度量是在 $I$ 坐标系中得出的。
从这个视角来看，$M\times N$ 也不是什么矩阵乘法了，而是声明了一个在$M$坐标系中量出的另一个坐标系 $N$，
其中 $M$ 本身是在 $I$ 坐标系中度量出来的。&lt;&#x2F;p&gt;
&lt;p&gt;回过头来说变换的问题。我刚才说，“固定坐标系下一个对象的变换等价于固定对象所处的坐标系变换”，那个“固定对象”我们找到了，就是那个向量。但是坐标系的变换呢？我怎么没看见？&lt;&#x2F;p&gt;
&lt;p&gt;请看：&lt;&#x2F;p&gt;
&lt;p&gt;$$Ma=Ib$$&lt;&#x2F;p&gt;
&lt;p&gt;我现在要变$M$为$I$，怎么变？对了，再前面乘以个 $M^{-1}$，也就是 $M$ 的逆矩阵。换句话说，你不是有一个坐标系 $M$ 吗，现在我让它乘以个 $M^{-1}$，变成 $I$，这样一来的话，原来$M$坐标系中的 $a$ 在 $I$ 中一量，就得到 $b$ 了。&lt;&#x2F;p&gt;
&lt;p&gt;我建议你此时此刻拿起纸笔，画画图，求得对这件事情的理解。比如，你画一个坐标系，$x$ 轴上的衡量单位是 $2$，$y$ 轴上的衡量单位是 $3$，在这样一个坐标系里，坐标为 $(1，1)$ 的那一点，实际上就是笛卡尔坐标系里的点 $(2,3)$。而让它原形毕露的办法，就是把原来那个坐标系:&lt;&#x2F;p&gt;
&lt;p&gt;$$\begin{bmatrix}
2 &amp;amp; 0 \\
0 &amp;amp; 3 \\
\end{bmatrix}$$&lt;&#x2F;p&gt;
&lt;p&gt;的 $x$ 方向度量缩小为原来的 $1\over 2$，而 $y$ 方向度量缩小为原来的 $1\over 3$，这样一来坐标系就变成单位坐标系 $I$ 了。保持点不变，那个向量现在就变成了 $(2,3)$ 了。&lt;&#x2F;p&gt;
&lt;p&gt;怎么能够让“ $x$ 方向度量缩小为原来的 $1\over 2$，而 $y$ 方向度量缩小为原来的 $1\over 3$ ”呢？就是让原坐标系：&lt;&#x2F;p&gt;
&lt;p&gt;$$\begin{bmatrix}
2 &amp;amp; 0 \\
0 &amp;amp; 3 \\
\end{bmatrix}$$&lt;&#x2F;p&gt;
&lt;p&gt;被矩阵：&lt;&#x2F;p&gt;
&lt;p&gt;$$\begin{bmatrix}
1\over 2 &amp;amp; 0 \\
0 &amp;amp; 1\over 3 \\
\end{bmatrix}$$
左乘。而这个矩阵就是原矩阵的逆矩阵。&lt;&#x2F;p&gt;
&lt;p&gt;下面我们得出一个重要的结论：&lt;&#x2F;p&gt;
&lt;p&gt;&lt;font color=red&gt;“对坐标系施加变换的方法，就是让表示那个坐标系的矩阵与表示那个变化的矩阵相乘。”&lt;&#x2F;font&gt;&lt;&#x2F;p&gt;
&lt;p&gt;再一次的，矩阵的乘法变成了运动的施加。只不过，被施加运动的不再是向量，而是另一个坐标系。&lt;&#x2F;p&gt;
&lt;p&gt;如果你觉得你还搞得清楚，请再想一下刚才已经提到的结论，矩阵 $M\times N$，一方面表明坐标系 $N$ 在运动 $M$ 下的变换结果，另一方面，把 $M$ 当成 $N$ 的前缀，当成 $N$ 的环境描述，那么就是说，在 $M$ 坐标系度量下，有另一个坐标系 $N$。这个坐标系 $N$ 如果放在 $I$ 坐标系中度量，其结果为坐标系 $M\times N$。&lt;&#x2F;p&gt;
&lt;p&gt;在这里，我实际上已经回答了一般人在学习线性代数是最困惑的一个问题，那就是为什么矩阵的乘法要规定成这样。简单地说，是因为：&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;从变换的观点看，对坐标系 $N$ 施加 $M$ 变换，就是把组成坐标系 $N$ 的每一个向量施加 $M$ 变换。&lt;&#x2F;li&gt;
&lt;li&gt;从坐标系的观点看，在 $M$ 坐标系中表现为$N$的另一个坐标系，这也归结为，对 $N$ 坐标系基的每一个向量，把它在 $I$ 坐标系中的坐标找出来，然后汇成一个新的矩阵。&lt;&#x2F;li&gt;
&lt;li&gt;至于矩阵乘以向量为什么要那样规定，那是因为一个在 $M$ 中度量为 $a$ 的向量，如果想要恢复在 $I$ 中的真相，就必须分别与 $M$ 中的每一个向量进行內积运算。我把这个结论的推导留给感兴趣的朋友吧。应该说，其实到了这一步，已经很容易了。&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;综合以上，矩阵的乘法就得那么规定，一切有根有据，绝不是哪个神经病胡思乱想出来的。&lt;&#x2F;p&gt;
&lt;p&gt;我已经无法说得更多了。矩阵又是坐标系，又是变换。到底是坐标系，还是变换，已经说不清楚了，运动与实体在这里统一了，物质与意识的界限已经消失了，一切归于无法言说，无法定义了。道可道，非常道，名可名，非常名。矩阵是在是不可道之道，不可名之名的东西。到了这个时候，我们不得不承认，我们伟大的线性代数课本上说的矩阵定义，是无比正确的：&lt;&#x2F;p&gt;
&lt;p&gt;“矩阵就是由 $m$ 行 $n$ 列数放在一起组成的数学对象。”&lt;&#x2F;p&gt;
&lt;p&gt;好了，这基本上就是我想说的全部了。还留下一个行列式的问题。矩阵 $M$ 的行列式实际上是组成 $M$ 的各个向量按照平行四边形法则搭成一个 $n$ 维立方体的体积。对于这一点，我只能感叹于其精妙，却无法揭开其中奥秘了。也许我掌握的数学工具不够，我希望有人能够给我们大家讲解其中的道理了。&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>艾波寧捎信</title>
        <published>2017-06-11T00:00:00+00:00</published>
        <updated>2017-06-11T00:00:00+00:00</updated>
        <author>
          <name>Unknown</name>
        </author>
        <link rel="alternate" href="https://www.freeopen.tech/eponine/" type="text/html"/>
        <id>https://www.freeopen.tech/eponine/</id>
        
        <content type="html">&lt;blockquote&gt;
&lt;p&gt;由台大葉丙成老師的学生创作的概率问题，文章本身比问题更有趣。&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;巴黎, 1832 年 6 月, 一個飄著毛雨的濕熱夜晚。&lt;&#x2F;p&gt;
&lt;p&gt;一間破舊的旅社, 歪一邊的招牌寫著「德納第客棧」(Thénardier’s)。
一樓的大廳裡, —— 說大廳, 其實只是兩張沙發跟一個小圓桌組成的狹窄空間 —— 只有坐著的兩位老友,
他們多年不見, 正在暢談。&lt;&#x2F;p&gt;
&lt;p&gt;留著滿臉花白大鬍子跟八字鬚,滔滔不絕的是作家維克托.雨果(Victor Hugo)。
旁邊靜靜聽著的那人是雨果的朋友, 一位正直的英國詩人。
他年輕許多,留著捲髮,有深 邃的眼神跟鷹鉤鼻。&lt;&#x2F;p&gt;
&lt;p&gt;「最近交稿期限又要到了,」雨果說,
「我的靈感卻像這個酒杯一樣枯竭呀。老闆娘! 來一瓶上好的波本威士忌,再來一盤肉乾下酒。」&lt;&#x2F;p&gt;
&lt;p&gt;一直低頭擦盤子的老闆娘放下工作, 來招呼她的顧客。&lt;&#x2F;p&gt;
&lt;p&gt;「我也何嘗不是入不敷出。」英國詩人說。「畢竟作詩這種東西又不能當飯吃。」&lt;&#x2F;p&gt;
&lt;p&gt;這時有人推開嘎吱作響的木門, 匆忙走進旅社, 靠近沙發上的兩人。
他的臉有點圓而結實, 額上的皺紋大概是常年經過思考的結果。
「維克托! 」他喊道。&lt;&#x2F;p&gt;
&lt;p&gt;「大數學家西米翁.泊松(Siméon Poisson)駕到啦! 」雨果調侃道。
「幾年沒見了? 怎麼氣喘吁吁的? 」&lt;&#x2F;p&gt;
&lt;p&gt;「呼…呼…都半百年紀了,一把老骨頭了。」泊松說道, 揉了揉背。&lt;&#x2F;p&gt;
&lt;p&gt;「下禮拜就是你 51 歲生日了吧? 順便慶祝一下? 」雨果真是那壺不開提那壺。&lt;&#x2F;p&gt;
&lt;p&gt;「別提了….」泊松說。「咦? 我剛才要說什麼? 對了, 警察把學生叛軍逼到絕路,
剩下一個據點了。附近的街道都封起來, 說經過的格殺勿論! 大家要小心。」 &lt;&#x2F;p&gt;
&lt;p&gt;「學生就是這樣, 因為一點小事動不動抗議。」雨果說。「哎,這個社會最近真的
很亂。聽說有個逃犯叫尚萬強(Jean-Valjean), 非常危險, 本以為被抓了, 原來是弄錯人。」&lt;&#x2F;p&gt;
&lt;p&gt;「這種人最好關到死。」泊松道。「大革命之後已經亂了三十幾年了, 不用嚴刑峻法怎麼治國? 」他舉杯。「乾啦! 」&lt;&#x2F;p&gt;
&lt;p&gt;門外的街道上,一個棕髮女子戴著毛氈帽,穿土黃色大衣,正快步經過。
「如果我 們之間從來都不可能,」她喃喃自語道,「告白只會讓他困擾吧? 
我想著他,跟他想著 她,有什麼不同? 也許我只是個好人,」她踢了踢年久失修的鋪路的石版。
「那就讓我 再作一次好人吧。假如我是他——寬宏大量的革命領袖,馬里歐斯(Marius) ——」
她呼了一口氣,不知是因為喘還是憤怒。
「又何嘗不想把這封訣別的情書交到柯賽特 (Cosette)手裡?」她的手一直埋在大衣口袋裡, 這時終於伸出。
月色下,隱約見到她原來是捏著一封信,汗都快把封蠟融化了。
她繼續沒入巷弄陰影中。&lt;&#x2F;p&gt;
&lt;p&gt;砰! 老闆娘手裡的盤子摔到地上, 引起三人的注意。「艾波寧(Éponine)! 艾波寧!」 老闆娘頭探出窗外叫道,「你要去哪?」&lt;&#x2F;p&gt;
&lt;p&gt;幾陣槍響讓室內一片寂靜, 只剩下老掛鐘的滴答聲渾然不覺於此。英國詩人坐得離
窗戶最遠,也把頭湊近。可是那女孩早已隱沒在黑夜中。&lt;&#x2F;p&gt;
&lt;p&gt;「我看她凶多吉少。」雨果道, 又啜了一口威士忌。&lt;&#x2F;p&gt;
&lt;p&gt;「不會吧? 」詩人說, 也喝了口咖啡。「政府財務拮据,那槍也不知道放幾年了, 又在黑夜當中,我懷疑 20 秒能不能打中一發! 」
他想開個玩笑,兩位朋友卻沒有反應。&lt;&#x2F;p&gt;
&lt;p&gt;「你估的差不多。」泊松說,「其實我剛才一直在注意士兵的命中率,」他敲了敲懷錶的錶面, 眼睛亮了起來。
「讓我們來作個假設: 士兵是否擊中她,是隨時間的均 勻泊松事件(Poisson process),參數也不隨距離變化。」&lt;&#x2F;p&gt;
&lt;p&gt;「又在炫耀以他為名的分布,」詩人咕噥著。&lt;&#x2F;p&gt;
&lt;p&gt;「她被擊中之後,」雨果也被引起興趣了,「應該還可以走一段路。那就假設她每中一槍, 速度就減半,
直到中 4 槍時當場斃命。那她成功穿過巷子的機率是多少,你算得出來嗎? 」&lt;&#x2F;p&gt;
&lt;p&gt;「小意思! 」 泊松答道,「為了方便計算,令 μ = 100 &#x2F; ln( 50 ) = 25.5622,再令這條巷子長 400 m。
她以 4 m&#x2F;s 的初速出發, 而且一出巷子就不會被擊中, 好嗎? 」 雨果點頭。&lt;&#x2F;p&gt;
&lt;p&gt;「你有沒有在聽啊? 」泊松問詩人, 後者一直低頭查字典。&lt;&#x2F;p&gt;
&lt;p&gt;「感謝那個狙擊手! 我又有靈感了。」詩人抬起頭說,「你們要聽聽嗎? 」他等不及兩人回應, 便拿出羽毛筆, 順手沾了咖啡, 拿起泛黃的報紙,邊寫邊念。他秀麗的字 跡活像中世紀手稿。&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Neath lamplights as ‘Ponine roved, on her own        當艾波宁形單影隻地漫步,沿著街燈

Professing to thin air (her absent crush)            向空氣(她不 在場的心上人)吐露

What each heart-broken maid, e’en lad, had known,    所有心碎女孩(甚至男孩)都懂的心聲,

The rain her tears wiped; Seine, weeping a gush,     雨水拭去她眼泪;塞納河洪流如注, 

Too called the freedom fighter who did fix           一起哭著呼喚自由鬥士: 他鎖定目光,

His eyes on noosing curly locks — not wars           向柯賽特能絞死人的捲髮,

He led — of blonde Cosette with rosy cheeks          而非戰爭。弟兄的血塊與刀傷,

Bloodier than brethren’s gore ignored and sores.     血紅色比不上金髮女粉紅雙頰。

O singing swan! Whose speed, once shot, would halve; 歌唱的天鵝! (一被擊中速度就減半) 

Must you this letter send to Hades black?            為何定要送這信到黑暗的冥府?

With Poisson bein’ the butcher’s PMF,                助紂為虐的子彈不會收回刀尖,

Abetting bullets take no blade aback!                因為泊松分布是屠夫的機率質量函数 !

Cruel witnesses! Ask Probability,                    無情的目擊者! 去請求“機率” 

Still speechless, to relate the tragedy.             (他仍啞口無言)訴说這場悲劇。
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;「講法文啦,我聽不懂。」泊松還在低頭計算。&lt;&#x2F;p&gt;
&lt;p&gt;「寫的真好! 」雨果言不由衷地附和著。「我知道! 這是…」他說, 想要裝懂。 
「義大利八行體(octave)? 法國十九行體(villanelle)? 」&lt;&#x2F;p&gt;
&lt;p&gt;「你連幾行都數不出來嗎? 你根本沒在聽吧? 」詩人激動地站起來,把咖啡弄倒 了。&lt;&#x2F;p&gt;
&lt;p&gt;「你如果真的關心社會,」雨果說, 生氣了。「為什麼不像拜倫(Byron)一樣參與希臘革命, 卻在這裡大放厥詞? 」&lt;&#x2F;p&gt;
&lt;p&gt;「那你呢? 」詩人回嘴,「自以為在揭露陰暗面,還不是坐在這裡喝咖啡! 」&lt;&#x2F;p&gt;
&lt;p&gt;「誰跟你社會寫實了? 」雨果說,「只要把情節弄聳動一點,能賣錢就好啦! 」他趁老闆娘不注意, 別過頭,啐了一口煙草到地上。&lt;&#x2F;p&gt;
&lt;p&gt;「我算出來了! 」泊松趕緊轉移話題。「我跟你講,先算恰中 n 槍的機率,再遞迴 地算中第 n + 1 槍的機率。我真是天才! 哈哈哈!」&lt;&#x2F;p&gt;
&lt;p&gt;「可是這個積分好難算喔。」雨果湊過去看。&lt;&#x2F;p&gt;
&lt;p&gt;「你笨耶! 先作個變數變換,然後這樣…這樣…」他指著紙上潦草的鬼畫符說。 
「嗯…嗯…」詩人應道,但是根本沒在看。
「這個肉乾到底是貓肉還是馬肉呀? 我突然覺得肚子不太舒服,先去休息了。」
看到兩位朋友對他的詩興趣索然,詩人有點不悅,找了藉口。&lt;&#x2F;p&gt;
&lt;p&gt;「老鼠肉。」老闆娘低聲道, 小聲到三人沒有聽見。她早已恢復平靜,繼續撿地上的碎片。&lt;&#x2F;p&gt;
&lt;p&gt;「其實我也覺得胃有點痛。」泊松道,看起來不像是裝的。瞪著天花板沈思許久的雨果起身。
「都多虧你的詩,」他說,「又讓我有一個長篇 小說的題材了! 我得趁忘記以前熬夜把大綱寫下來。」
他起身。「明天見囉! 到時再帶 你去參觀奧賽美術館(Musée d’Orsay)。」
他跟詩人說。「只是要繞過抗議的學生就是。」&lt;&#x2F;p&gt;
&lt;p&gt;「他們真的很煩。」泊松附和道。&lt;&#x2F;p&gt;
&lt;p&gt;「對呀。」雨果說。「我們的詩人朋友難得來拜訪, 當然要帶他好好參觀這個古都呀! 偏偏碰到這種事。」&lt;&#x2F;p&gt;
&lt;p&gt;互道晚安後,一行人各自上樓回房了。當旅社最後一盞燈暗下,花都巴黎又恢復了
平日的寂靜。除了遠處群眾隱約的喧鬧聲,還有槍枝的星火與夜空中的星光相映。&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;如上, 巷子呈直線, 長 L0 = 400 m, 艾波宁以 v0 = 4 m&#x2F;s 初速等速穿越。
士兵時時刻刻瞄準她; 第 t 秒時是否擊中她,是隨時間 t 的均勻的泊松事件(Poisson process), 且與距离無關。
其中, 平均每 μ 秒能擊中一次, μ = 100 &#x2F; ln( 50 ) 約為 25.5622。
士兵無法 擊中巷子以外的區域; 另外,只要她處於巷中, μ 就是常数 。&lt;&#x2F;p&gt;
&lt;p&gt;當她每被擊中一槍, 速度就會減半; 直到她恰中 4 槍時, 會當場死亡。
亦即, 中 n 槍時速依序為 4、2、1、0.5 m&#x2F;s,其中 n 依序為 0、 1、 2、 3。&lt;&#x2F;p&gt;
&lt;p&gt;請問艾波宁成功捎信的機率為何? 亦即, 在她處於巷子之中時, 被射中低於四槍的機率為何?&lt;&#x2F;p&gt;
</content>
        
    </entry>
</feed>
